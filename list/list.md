## 为什么用消息队列
- 消息队列优势
    - 异步
    - 解耦
    - 削峰
- 存在的问题及如何解决
    - 系统复杂性
    - 数据一致性
    - 可用性

## 好的消息队列需要关注的问题
- 高可用： 一定是分布式部署（集群）
- 消息丢失： 消息持久化问题
- 消息有序

## 消息重复消费、顺序消费、分布式事务
- 重复消费
> **场景**：一个消息有多个消费者，当其中一个消费失败，要求重新发送一次消息。那么其他消费成功的也会再次收到同样的消息。</br>
> **解决方案**：首先涉及到重要的接口需要做强校验，例如：可以有一个流水表，操作完之后，就会向流水表写一条记录（消费和流水写记录放到一个事务去做）。下次相同的消息在来的时候，先从流水表查询，有记录直接返回。没有记录重新消费。涉及到非重要性接口，例如：短信通知，可以加个临时缓存，就算丢失也无可厚非

- 消费顺序错乱
> **场景**： 例如：下单、支付和发货三个消息，是顺序产生的，当发送到消息队列时一个topic 有多个队列，为了保证顺序消费，需要把这些消息发送给 一个队列，然后队列采用 fifo，顺序消费。 </br>
> **方案**： 为了发送到同一个队列，可以使用 订单号hash取模，使相同的订单号都落到相同的队列。为了保证下游消费顺序，一般前面的消费成功后，在发下一个消息


## Kafka 介绍

